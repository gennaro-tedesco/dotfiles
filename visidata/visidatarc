# type: ignore
from visidata import CellColorizer, Column, Sheet, TableSheet, options, vd

## sidebar
options.disp_sidebar = False
options.color_sidebar = "black on 8"

## colour palette
options.color_active_status = "8"
options.color_aggregator = "202 on normal"
options.color_bottom_hdr = "8 underline bold"
options.color_code = "normal"
options.color_column_sep = "8"
options.color_cmdpalette = "8"
options.color_current_cell = "bold"
options.color_current_col = "normal"
options.color_current_row = "yellow underline"
options.color_default = True
options.color_edit_cell = "normal"
options.color_edit_unfocused = "8 bold"
options.color_heading = "black on yellow"
options.color_keystrokes = "cyan"
options.color_key_col = "cyan"
options.color_longname_status = "normal"
options.color_match = "202 bold"
options.color_menu = "cyan underline reverse"
options.color_menu_active = "yellow reverse"
options.color_menu_help = "cyan underline reverse"
options.color_menu_spec = "yellow underline"
options.color_selected_row = "14"
options.color_status = "8"
options.disp_edit_fill = ""

## general options
options.save_filetype = "csv"
options.disp_float_fmt = "%.03f"
options.scroll_incr = -3
options.numeric_binning = True
options.disp_scroll_context = 5


## ------------------------------
## definition of custom functions
## ------------------------------
def colours(s, c, r, v):
    if v and vd.isNumeric(c):
        if v.typedval > 0.0:
            return 2
        if v.typedval < 0.0:
            return 1


def FrequencyColumn(sourceCol):
    return Column(
        sourceCol.name + "_frequency",
        getter=lambda c, r: c.source.getTypedValue(r) / c.total,
        source=sourceCol,
        total=sum(sourceCol.getValues(sourceCol.sheet.rows)),
    )


@Sheet.api
def add_colours(sheet):
    sheet.addColorizer(CellColorizer(100, None, colours))


@Sheet.api
def remove_colours(sheet):
    sheet.removeColorizer(CellColorizer(100, None, colours))


## -----------------------------
## definition of custom commands
## -----------------------------
Sheet.addCommand(None, "add-colours", "add_colours()", "add colour coding")
Sheet.addCommand(None, "remove-colours", "remove_colours()", "remove colour coding")


TableSheet.unbindkey("f")
Sheet.addCommand(
    "f", "addcol-freq", "addColumn(FrequencyColumn(cursorCol), index=cursorColIndex+1)"
)

TableSheet.unbindkey("i")
TableSheet.bindkey("i", "edit-cell")


TableSheet.unbindkey("^D")
TableSheet.bindkey("^U", "go-pageup")
TableSheet.bindkey("^D", "go-pagedown")
